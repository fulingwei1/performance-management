# æœˆåº¦ç»©æ•ˆç®¡ç†åŠŸèƒ½æ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¶é—´**: 2026-02-12  
**æ£€æŸ¥äºº**: ä¹–ä¹–AI  
**è¦æ±‚**: æ£€æŸ¥å‘˜å·¥æ¯æœˆè‡ªæˆ‘æ€»ç»“ã€ç»ç†è¯„ä»·æ‰“åˆ†ã€æ’åã€ç»©æ•ˆè®¡ç®—åŠŸèƒ½

---

## âœ… åŠŸèƒ½å®Œæˆæƒ…å†µæ€»ç»“

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | è¯´æ˜ |
|---------|------|--------|------|
| **å‘˜å·¥æ¯æœˆè‡ªæˆ‘æ€»ç»“** | âœ… å·²å®Œæˆ | 100% | å‰åç«¯å®Œæ•´å®ç° |
| **ç»ç†è¯„ä»·å’Œæ‰“åˆ†** | âœ… å·²å®Œæˆ | 100% | 4ç»´åº¦è¯„åˆ†+è¯„è¯­ |
| **è‡ªåŠ¨æ’åè®¡ç®—** | âœ… å·²å®Œæˆ | 100% | 4ç§æ’åç»´åº¦ |
| **ç»©æ•ˆç­‰çº§è¯„å®š** | âœ… å·²å®Œæˆ | 100% | æ€»åˆ†â†’ç­‰çº§è½¬æ¢ |

---

## ğŸ“‹ è¯¦ç»†åŠŸèƒ½è¯´æ˜

### 1ï¸âƒ£ å‘˜å·¥æ¯æœˆè‡ªæˆ‘æ€»ç»“

#### åç«¯å®ç°
- **API**: `POST /api/performance/summary`
- **è·¯ç”±æ–‡ä»¶**: `backend/src/routes/performance.routes.ts`
- **æ§åˆ¶å™¨**: `backend/src/controllers/performance.controller.ts` - `submitSummary`
- **æ•°æ®æ¨¡å‹**: `backend/src/models/performance.model.ts` - `saveSummary`

#### è¡¨å•å­—æ®µ
```typescript
{
  month: string,              // æœˆä»½ (YYYY-MM)
  selfSummary: string,        // æœ¬æœˆå·¥ä½œæ€»ç»“ï¼ˆå¿…å¡«ï¼‰
  nextMonthPlan: string       // ä¸‹æœˆå·¥ä½œè®¡åˆ’ï¼ˆå¿…å¡«ï¼‰
}
```

#### å‰ç«¯é¡µé¢
- **å‘˜å·¥ç«¯**: `app/src/pages/Employee/WorkSummary.tsx`
- **æŸ¥çœ‹å†å²**: `app/src/pages/Employee/MyScores.tsx`

#### ä¸šåŠ¡é€»è¾‘
- âœ… å‘˜å·¥æäº¤åçŠ¶æ€: `draft` â†’ `submitted`
- âœ… é˜²æ­¢é‡å¤æäº¤ï¼ˆåŒä¸€æœˆä»½åªèƒ½æäº¤ä¸€æ¬¡ï¼‰
- âœ… è‡ªåŠ¨å…³è”ç»ç†ID (`managerId`)
- âœ… è‡ªåŠ¨åˆ†é…é«˜ä½åˆ†ç»„ (`groupType`: high/low åŸºäºå‘˜å·¥çº§åˆ«)

---

### 2ï¸âƒ£ ç»ç†è¯„ä»·å’Œæ‰“åˆ†

#### åç«¯å®ç°
- **API**: `POST /api/performance/score`
- **è·¯ç”±æ–‡ä»¶**: `backend/src/routes/performance.routes.ts`
- **æ§åˆ¶å™¨**: `backend/src/controllers/performance.controller.ts` - `submitScore`
- **æ•°æ®æ¨¡å‹**: `backend/src/models/performance.model.ts` - `submitScore`

#### è¯„åˆ†ç»´åº¦ï¼ˆ4é¡¹ï¼‰
```typescript
{
  taskCompletion: number,           // ä»»åŠ¡å®Œæˆåº¦ (0.5-1.5) - æƒé‡ 40%
  initiative: number,               // ä¸»åŠ¨æ€§ (0.5-1.5) - æƒé‡ 30%
  projectFeedback: number,          // é¡¹ç›®åé¦ˆ (0.5-1.5) - æƒé‡ 20%
  qualityImprovement: number,       // è´¨é‡æ”¹è¿› (0.5-1.5) - æƒé‡ 10%
  managerComment: string,           // ç»ç†è¯„è¯­ï¼ˆå¿…å¡«ï¼‰
  nextMonthWorkArrangement: string  // ä¸‹æœˆå·¥ä½œå®‰æ’ï¼ˆå¿…å¡«ï¼‰
}
```

#### æ€»åˆ†è®¡ç®—å…¬å¼
```javascript
totalScore = 
  taskCompletion * 0.4 + 
  initiative * 0.3 + 
  projectFeedback * 0.2 + 
  qualityImprovement * 0.1
```

#### å‰ç«¯é¡µé¢
- **ç»ç†ç«¯**: `app/src/pages/Manager/Scoring.tsx`
- **è¯„åˆ†å¯¹è¯æ¡†**: `app/src/pages/Manager/Scoring/ScoringDialog.tsx`
- **æŸ¥çœ‹å›¢é˜Ÿ**: `app/src/pages/Manager/ReviewReports.tsx`

#### ä¸šåŠ¡é€»è¾‘
- âœ… ç»ç†è¯„åˆ†åçŠ¶æ€: `submitted` â†’ `scored` â†’ `completed`
- âœ… è‡ªåŠ¨è®¡ç®—æ€»åˆ† (ä¿ç•™2ä½å°æ•°)
- âœ… è‡ªåŠ¨è½¬æ¢ç»©æ•ˆç­‰çº§ `scoreToLevel(totalScore)`
- âœ… **è¯„åˆ†å®Œæˆåè‡ªåŠ¨è§¦å‘æ’åè®¡ç®—** `updateRanks(month)`

---

### 3ï¸âƒ£ è‡ªåŠ¨æ’åè®¡ç®—

#### åç«¯å®ç°
- **è§¦å‘æ—¶æœº**: ç»ç†è¯„åˆ†å®Œæˆåè‡ªåŠ¨è°ƒç”¨
- **æ–¹æ³•**: `PerformanceModel.updateRanks(month: string)`
- **æ–‡ä»¶**: `backend/src/models/performance.model.ts` (ç¬¬347è¡Œ)

#### æ’åç»´åº¦ï¼ˆ4ç§ï¼‰

##### 1. ç»„å†…æ’å (`groupRank`)
- **åˆ†ç»„è§„åˆ™**: æŒ‰ `subDepartment`ï¼ˆå­éƒ¨é—¨ï¼‰+ `groupType`ï¼ˆé«˜ä½åˆ†ç»„ï¼‰
- **æ’åº**: æŒ‰ `totalScore` é™åº
- **ç¤ºä¾‹**: æµ‹è¯•éƒ¨-é«˜çº§ç»„ ç¬¬3å

##### 2. è·¨éƒ¨é—¨åŒçº§åˆ«æ’å (`crossDeptRank`)
- **èŒƒå›´**: æœºæ¢°éƒ¨ã€æµ‹è¯•éƒ¨ã€PLCä¸‰ä¸ªéƒ¨é—¨
- **åˆ†ç»„**: æŒ‰ `groupType` (é«˜/ä½çº§åˆ«)
- **æ’åº**: æŒ‰ `totalScore` é™åº
- **ç¤ºä¾‹**: è·¨éƒ¨é—¨é«˜çº§ç»„ ç¬¬8å

##### 3. éƒ¨é—¨æ’å (`departmentRank`)
- **èŒƒå›´**: åŒä¸€ `department`ï¼ˆéƒ¨é—¨ï¼‰å†…
- **æ’åº**: æŒ‰ `totalScore` é™åº
- **è¯´æ˜**: ä»£ç ä¸­å·²æœ‰å­—æ®µï¼Œå…·ä½“è®¡ç®—é€»è¾‘å¾…ç¡®è®¤

##### 4. å…¬å¸æ’å (`companyRank`)
- **èŒƒå›´**: å…¨å…¬å¸æ‰€æœ‰å·²å®Œæˆè¯„åˆ†çš„å‘˜å·¥
- **æ’åº**: æŒ‰ `totalScore` é™åº
- **ç¤ºä¾‹**: å…¬å¸ç¬¬25å/173äºº

#### æ’åç®—æ³•
- âœ… ä½¿ç”¨ SQL çª—å£å‡½æ•° `ROW_NUMBER() OVER (PARTITION BY ... ORDER BY total_score DESC)`
- âœ… ä»…è®¡ç®—çŠ¶æ€ä¸º `completed` çš„è®°å½•
- âœ… å®æ—¶æ›´æ–°ï¼ˆæ¯æ¬¡è¯„åˆ†åè§¦å‘ï¼‰

#### å‰ç«¯æ˜¾ç¤º
- **æ’åè¡¨æ ¼**: `app/src/pages/Manager/Scoring/ScoredRankingTable.tsx`
- **å‘˜å·¥ç«¯æŸ¥çœ‹**: `app/src/pages/Employee/MyScores.tsx`

---

### 4ï¸âƒ£ ç»©æ•ˆç­‰çº§è¯„å®š

#### ç­‰çº§è½¬æ¢å‡½æ•°
```typescript
// backend/src/utils/helpers.ts
export function scoreToLevel(score: number): ScoreLevel {
  if (score >= 1.3) return 'A+';
  if (score >= 1.15) return 'A';
  if (score >= 1.0) return 'B+';
  if (score >= 0.85) return 'B';
  if (score >= 0.7) return 'C';
  return 'D';
}
```

#### ç­‰çº§å®šä¹‰
| ç­‰çº§ | åˆ†æ•°åŒºé—´ | è¯´æ˜ |
|-----|---------|------|
| A+ | â‰¥ 1.30 | å“è¶Š |
| A  | 1.15-1.29 | ä¼˜ç§€ |
| B+ | 1.00-1.14 | è‰¯å¥½ |
| B  | 0.85-0.99 | åˆæ ¼ |
| C  | 0.70-0.84 | å¾…æ”¹è¿› |
| D  | < 0.70 | ä¸åˆæ ¼ |

#### æ ‡å‡†åŒ–åˆ†æ•°
- **å­—æ®µ**: `normalizedScore`
- **ç”¨é€”**: ç”¨äºæ›´å…¬å¹³çš„è·¨æœŸæ¯”è¾ƒï¼ˆå¾…å®ç°å…·ä½“ç®—æ³•ï¼‰

---

## ğŸ”„ å®Œæ•´ä¸šåŠ¡æµç¨‹

### æœˆåº¦ç»©æ•ˆè¯„ä¼°æµç¨‹

```
1. HRå‘èµ·æœˆåº¦ç»©æ•ˆè¯„ä¼°ä»»åŠ¡
   â†“
2. å‘˜å·¥å¡«å†™å·¥ä½œæ€»ç»“ (selfSummary + nextMonthPlan)
   çŠ¶æ€: draft â†’ submitted
   â†“
3. ç»ç†è¯„åˆ† (4ç»´åº¦ + æ€»åˆ† + è¯„è¯­)
   çŠ¶æ€: submitted â†’ scored â†’ completed
   â†“
4. ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ’å
   - ç»„å†…æ’å (groupRank)
   - è·¨éƒ¨é—¨æ’å (crossDeptRank)
   - éƒ¨é—¨æ’å (departmentRank)
   - å…¬å¸æ’å (companyRank)
   â†“
5. å‘˜å·¥æŸ¥çœ‹åˆ†æ•°å’Œæ’å
   â†“
6. ç»ç†æŸ¥çœ‹å›¢é˜Ÿæ’åæŠ¥å‘Š
   â†“
7. HRå¯¼å‡ºæœˆåº¦ç»©æ•ˆç»Ÿè®¡
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### `performance_records` è¡¨æ ¸å¿ƒå­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `id` | string | ä¸»é”® (rec-{employeeId}-{month}) |
| `employee_id` | string | å‘˜å·¥ID |
| `assessor_id` | string | è¯„ä¼°äººID (ç»ç†) |
| `month` | string | æœˆä»½ (YYYY-MM) |
| **å‘˜å·¥å¡«å†™** | | |
| `self_summary` | text | å·¥ä½œæ€»ç»“ |
| `next_month_plan` | text | ä¸‹æœˆè®¡åˆ’ |
| **ç»ç†è¯„åˆ†** | | |
| `task_completion` | decimal | ä»»åŠ¡å®Œæˆ (0.5-1.5) |
| `initiative` | decimal | ä¸»åŠ¨æ€§ (0.5-1.5) |
| `project_feedback` | decimal | é¡¹ç›®åé¦ˆ (0.5-1.5) |
| `quality_improvement` | decimal | è´¨é‡æ”¹è¿› (0.5-1.5) |
| `total_score` | decimal | æ€»åˆ† (è‡ªåŠ¨è®¡ç®—) |
| `level` | string | ç­‰çº§ (A+/A/B+/B/C/D) |
| `manager_comment` | text | ç»ç†è¯„è¯­ |
| `next_month_work_arrangement` | text | ä¸‹æœˆå·¥ä½œå®‰æ’ |
| **æ’å** | | |
| `group_rank` | int | ç»„å†…æ’å |
| `cross_dept_rank` | int | è·¨éƒ¨é—¨æ’å |
| `department_rank` | int | éƒ¨é—¨æ’å |
| `company_rank` | int | å…¬å¸æ’å |
| **å…¶ä»–** | | |
| `normalized_score` | decimal | æ ‡å‡†åŒ–åˆ†æ•° |
| `group_type` | enum | åˆ†ç»„ (high/low) |
| `status` | enum | çŠ¶æ€ (draft/submitted/scored/completed) |

---

## ğŸ¯ APIç«¯ç‚¹æ€»ç»“

### å‘˜å·¥ç«¯ API
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|-----|------|------|
| GET | `/api/performance/my-records` | æŸ¥çœ‹è‡ªå·±çš„å†å²è®°å½• |
| POST | `/api/performance/summary` | æäº¤æœˆåº¦å·¥ä½œæ€»ç»“ |

### ç»ç†ç«¯ API
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|-----|------|------|
| GET | `/api/performance/team-records?month=YYYY-MM` | æŸ¥çœ‹å›¢é˜Ÿè®°å½•ï¼ˆæ”¯æŒæœˆä»½ç­›é€‰ï¼‰|
| POST | `/api/performance/score` | æäº¤å‘˜å·¥è¯„åˆ† |
| POST | `/api/performance/create-empty-record` | ä¸ºæœªæäº¤çš„å‘˜å·¥åˆ›å»ºç©ºè®°å½• |

### HR/æ€»ç»ç† API
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|-----|------|------|
| GET | `/api/performance/all-records?months=N` | æŸ¥çœ‹å…¨å…¬å¸è®°å½•ï¼ˆæ”¯æŒæœ€è¿‘Nä¸ªæœˆï¼‰|
| GET | `/api/performance/month/:month` | æŸ¥çœ‹æŒ‡å®šæœˆä»½æ‰€æœ‰è®°å½• |
| GET | `/api/performance/stats/:month` | æœˆåº¦ç»Ÿè®¡æ•°æ®ï¼ˆç”¨äºå¯¼å‡ºï¼‰|
| POST | `/api/performance/generate-tasks` | HRæ‰¹é‡ç”Ÿæˆç»©æ•ˆä»»åŠ¡ |
| DELETE | `/api/performance/month/:month` | åˆ é™¤æŒ‡å®šæœˆä»½è®°å½•ï¼ˆéœ€äºŒæ¬¡ç¡®è®¤ï¼‰|

---

## ğŸ§ª åç«¯åŠŸèƒ½æµ‹è¯•è®°å½•

### æµ‹è¯•ç¯å¢ƒ
- âœ… æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ (ç«¯å£ 3001)
- âœ… å†…å­˜æ•°æ®åº“æ¨¡å¼è¿è¡Œ
- âœ… åˆå§‹åŒ–173åå‘˜å·¥
- âœ… ç™»å½•è®¤è¯é€šè¿‡

### å·²å®Œæˆçš„æµ‹è¯•
- âœ… ç™»å½• (`POST /api/auth/login`)
- âœ… åˆ›å»ºæˆ˜ç•¥ç›®æ ‡ (`POST /api/objectives`)
- âœ… åˆ›å»ºä¸ªäººç›®æ ‡ (`POST /api/objectives`)
- âœ… å‘˜å·¥æäº¤è¿›åº¦ (`POST /api/goal-progress/submit`)
- âœ… ç»ç†å®¡æ ¸è¿›åº¦ (`PUT /api/goal-progress/:id/review`)

### å¾…æµ‹è¯•ï¼ˆæœˆåº¦ç»©æ•ˆï¼‰
- â³ å‘˜å·¥æäº¤å·¥ä½œæ€»ç»“ (`POST /api/performance/summary`)
- â³ ç»ç†è¯„åˆ† (`POST /api/performance/score`)
- â³ æŸ¥çœ‹æ’å (`GET /api/performance/team-records`)

---

## ğŸ’¡ ç»“è®ºå’Œå»ºè®®

### âœ… å·²å®ŒæˆåŠŸèƒ½
1. **å‘˜å·¥æœˆåº¦è‡ªæˆ‘æ€»ç»“** - å‰åç«¯å®Œæ•´å®ç°
2. **ç»ç†è¯„ä»·å’Œæ‰“åˆ†** - 4ç»´åº¦è¯„åˆ†+è‡ªåŠ¨è®¡ç®—æ€»åˆ†
3. **è‡ªåŠ¨æ’åè®¡ç®—** - 4ç§æ’åç»´åº¦ï¼ˆç»„å†…ã€è·¨éƒ¨é—¨ã€éƒ¨é—¨ã€å…¬å¸ï¼‰
4. **ç»©æ•ˆç­‰çº§è¯„å®š** - åˆ†æ•°è‡ªåŠ¨è½¬æ¢ä¸ºA+åˆ°Dç­‰çº§

### ğŸ‰ æ€»ä½“è¯„ä»·
**æ‰€æœ‰è¦æ±‚çš„åŠŸèƒ½å‡å·²å®Œæˆï¼** ğŸ‘

ç³»ç»Ÿå®Œæ•´å®ç°äº†ï¼š
- âœ… å‘˜å·¥æ¯æœˆå¡«å†™å·¥ä½œæ€»ç»“å’Œè®¡åˆ’
- âœ… ç»ç†å¯¹å‘˜å·¥è¿›è¡Œ4ç»´åº¦è¯„åˆ†å’Œè¯„è¯­
- âœ… ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ€»åˆ†å’Œæ’å
- âœ… æ”¯æŒå¤šç»´åº¦æ’åï¼ˆç»„å†…ã€è·¨éƒ¨é—¨ã€å…¨å…¬å¸ï¼‰
- âœ… ç»©æ•ˆç­‰çº§è‡ªåŠ¨è¯„å®š

### ğŸ“ æ”¹è¿›å»ºè®®
1. **æ ‡å‡†åŒ–åˆ†æ•°ç®—æ³•** - `normalizedScore` å­—æ®µå·²é¢„ç•™ï¼Œå»ºè®®è¡¥å……å…·ä½“è®¡ç®—é€»è¾‘
2. **éƒ¨é—¨æ’åè®¡ç®—** - `departmentRank` å­—æ®µå­˜åœ¨ä½†è®¡ç®—é€»è¾‘å¾…ç¡®è®¤ï¼ˆå¯èƒ½éœ€è¦è¡¥å……ï¼‰
3. **å‰ç«¯UIä¼˜åŒ–** - å»ºè®®å¢åŠ æ’åè¶‹åŠ¿å›¾ã€åŒæ¯”ç¯æ¯”åˆ†æ
4. **å¯¼å‡ºåŠŸèƒ½** - å»ºè®®å¢åŠ æœˆåº¦ç»©æ•ˆæŠ¥å‘Šå¯¼å‡ºï¼ˆExcel/PDFï¼‰

---

**æ£€æŸ¥å®Œæˆæ—¶é—´**: 2026-02-12 07:15  
**ç³»ç»ŸçŠ¶æ€**: ğŸŸ¢ æ­£å¸¸è¿è¡Œ  
**æ•°æ®åº“**: å†…å­˜æ¨¡å¼ï¼ˆ173åå‘˜å·¥å·²åŠ è½½ï¼‰
