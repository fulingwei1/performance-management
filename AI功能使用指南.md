# AI 辅助功能使用指南

## 🎯 功能概述

绩效管理系统现已集成AI辅助写作功能，帮助员工和经理更高效地完成绩效评价工作。

### 支持的AI功能

1. **员工自评** - AI帮助生成工作总结和计划
2. **经理评分** - AI帮助生成评价和工作安排

---

## 📦 配置要求

### 1. Kimi API Key

在 `backend/.env` 文件中添加：

```env
# Kimi (Moonshot) API Key
KIMI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 2. 获取API Key

1. 访问 https://platform.moonshot.cn/
2. 注册/登录账号
3. 进入"API密钥"页面
4. 创建新密钥
5. 复制密钥到`.env`文件

### 3. 重启服务

```bash
cd backend
npm run dev
```

---

## 🚀 使用方法

### 员工自评

#### 1. 进入月度工作总结页面
路径：员工仪表盘 → 月度工作总结

#### 2. 使用AI生成总结
- 点击"本月工作总结"旁边的 **"AI 帮我写"** 按钮
- 右侧抽屉打开，显示AI助手
- 点击 **"生成AI建议"** 按钮
- 等待5-10秒，AI生成3个版本
- 选择喜欢的版本，点击 **"采用此版本"**
- 总结自动填入输入框

#### 3. 使用AI生成下月计划
- 点击"下月工作计划"旁边的 **"AI 帮我写"** 按钮
- 重复上述步骤

#### 4. 编辑和提交
- 可以在AI建议基础上修改
- 满意后点击"提交"

---

### 经理评分

#### 1. 进入评分管理页面
路径：经理仪表盘 → 评分管理 → 选择员工

#### 2. 填写4维度评分
- 任务完成度（40%）
- 主动性（30%）
- 项目反馈（20%）
- 质量改善（10%）

#### 3. 使用AI生成综合评价
- 切换到"综合评价"标签
- 点击"综合评价"旁边的 **"AI 建议"** 按钮
- AI会根据：
  - 员工自评内容
  - 4维度得分
  - 历史表现（TODO）
  - 团队对比（TODO）
- 生成评价建议
- 选择合适的版本采用

#### 4. 使用AI生成工作安排
- 点击"下月工作安排"旁边的 **"AI 建议"** 按钮
- AI生成工作安排建议
- 采用后可继续编辑

#### 5. 提交评分
- 填写完所有必填项后提交

---

## 💡 AI生成说明

### 员工自评 - 本月工作总结

**AI会抓取的数据**:
- 员工基本信息（姓名、岗位、部门）
- 本月目标完成情况
- 参与的项目
- 上月经理评价

**生成内容特点**:
- 200-300字
- 客观、专业、积极
- 突出重点和亮点
- 3个不同风格的版本

### 员工自评 - 下月工作计划

**AI会抓取的数据**:
- 年度目标
- 本月工作总结
- 当前进度

**生成内容特点**:
- 150-200字
- 具体可行
- 与年度目标一致
- 3个版本供选择

### 经理评价 - 综合评价

**AI会抓取的数据**:
- 员工自评内容
- 4维度得分
- 历史绩效趋势（TODO）
- 团队平均分和排名（TODO）

**生成内容包含**:
- 综合评价（150-200字）
- 推荐的正面关键词（3-5个）
- 推荐的待改进关键词（1-2个）
- 具体改进建议

### 经理评价 - 下月工作安排

**AI会抓取的数据**:
- 员工目标进度
- 本月综合评价

**生成内容特点**:
- 100-150字
- 具体、鼓励
- 明确任务和期望
- 3个版本

---

## 🎨 UI/UX 特点

### 侧边栏抽屉设计
- 不干扰主界面
- 同时查看AI建议和输入框
- 可对比多个版本

### 版本卡片
- 紫色主题，区分度高
- 显示字数统计
- 鼠标悬停显示"采用"按钮
- 点击后自动填入

### 加载状态
- 旋转动画
- 预估时间提示（5-10秒）

### 错误处理
- 友好的错误提示
- "重新生成"按钮
- 不影响原有输入

---

## 🔒 安全与权限

### 权限控制
- 员工只能为自己生成建议
- 经理只能为下属生成评价
- 后端验证token和角色

### 数据隐私
- API Key存储在后端环境变量
- 前端不暴露密钥
- 使用HTTPS传输

### 调用限制（TODO）
- 员工每月10次
- 经理每月50次
- 超限提示

---

## 📊 成本监控

### 调用日志（TODO）
记录每次AI调用：
- 用户ID
- 功能类型
- Token使用量
- 预估成本

### 统计报表（TODO）
- 每日/月使用量
- 成本趋势
- 热门功能

---

## 🐛 常见问题

### Q: 点击AI按钮没反应？
A: 
1. 检查后端是否启动
2. 检查Kimi API Key是否配置
3. 打开浏览器开发者工具查看Network错误

### Q: AI生成失败？
A: 
1. 检查API Key是否正确
2. 检查网络连接
3. 查看后端日志（控制台）
4. 尝试重新生成

### Q: 生成的内容不满意？
A: 
1. 点击"重新生成"获取新版本
2. 在AI建议基础上手动修改
3. 不采用，直接手写

### Q: 如何查看API使用量？
A: 
1. 登录 https://platform.moonshot.cn/
2. 进入"用量统计"页面

---

## 🚧 待开发功能

### Phase 2 增强
- [ ] 调用次数限制
- [ ] 使用日志记录
- [ ] 成本统计报表
- [ ] 更丰富的历史数据（团队对比、历史趋势）

### Phase 3 优化
- [ ] OpenClaw备用方案
- [ ] 提示词优化（根据实际效果）
- [ ] 自定义AI模型选择
- [ ] AI生成历史记录

---

## 📞 技术支持

遇到问题可以：
1. 查看后端控制台日志
2. 查看浏览器开发者工具Console
3. 检查 `/api/health` 端点状态
4. 联系系统管理员

---

**祝你使用愉快！** 🎉
